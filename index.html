<!DOCTYPE html><html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Einarmiger Bandit – 5 Walzen</title>
  <style>
    :root{
      --bg:#0b0f14; --panel:#121822; --accent:#1dd1a1; --muted:#7f8fa6; --win:#feca57; --lose:#ee5253;
    }
    html,body{height:100%;}
    body{
      margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:#e6edf3; background:radial-gradient(1200px 700px at 50% -10%, #1b2330 0%, #0b0f14 60%);
      display:grid; place-items:center; padding:24px;
    }
    .app{width:min(980px, 96vw);}
    h1{margin:0 0 8px 0; font-weight:700; letter-spacing:.5px}
    .sub{color:var(--muted); margin-bottom:16px}.machine{background:linear-gradient(180deg, #15202b 0%, #0e141b 100%); border:1px solid #263243; border-radius:18px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
.status{display:flex; gap:16px; justify-content:space-between; align-items:center; margin-bottom:12px}
.status .left{display:flex; gap:16px; align-items:center}
.chip{background:#0e1520; border:1px solid #1e2b3c; padding:8px 10px; border-radius:12px; min-width:120px}
.chip strong{display:block; font-size:14px}
.chip span{color:var(--muted); font-size:12px}

.reels{
  display:grid; grid-template-columns: repeat(5, 1fr); gap:12px; padding:12px; border-radius:16px; background:#0b121b; border:1px solid #1f2a3a;
}
.reel{
  height:180px; overflow:hidden; position:relative; border-radius:12px; background:#0a1018; border:1px solid #1c2736; box-shadow:inset 0 8px 18px rgba(0,0,0,.35)
}
.symbols{ position:absolute; left:0; right:0; will-change:transform }
.symbol{ height:60px; display:grid; place-items:center; font-weight:700; font-size:18px; letter-spacing:.4px; border-bottom:1px solid #0f1824 }
.symbol:nth-child(odd){ background:rgba(255,255,255,.02) }

.payline{ height:0; border-top:3px solid rgba(29,209,161,.6); position:relative; top:-93px; margin:0 6px }

.controls{ display:flex; gap:12px; align-items:center; justify-content:space-between; margin-top:14px }
.left-ctrl{display:flex; gap:12px; align-items:center}
.btn{ cursor:pointer; user-select:none; padding:12px 16px; border-radius:12px; border:1px solid #1e2b3a; background:#0e1622; color:#e6edf3; font-weight:700; letter-spacing:.4px; transition:.15s transform, .15s background }
.btn:disabled{ opacity:.5; cursor:not-allowed }
.btn.primary{ background:linear-gradient(180deg, #17b890 0%, #119a7b 100%); border-color:#0d6f5a; color:#02130f }
.btn.primary:hover{ transform:translateY(-1px) }

.bet{ display:flex; align-items:center; gap:8px }
.bet input{ width:90px; padding:10px; border-radius:10px; border:1px solid #263243; background:#0b111a; color:#e6edf3; font-weight:700 }

.log{ margin-top:12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#0b111a; border:1px solid #1f2a3a; padding:10px 12px; border-radius:12px; color:#aab8c2; height:92px; overflow:auto }
.log b{ color:#e6edf3 }
.flash-win{ animation:flash 800ms ease-in-out }
@keyframes flash{ 0%{box-shadow:0 0 0 0 rgba(254,202,87,.0)} 50%{box-shadow:0 0 0 6px rgba(254,202,87,.3)} 100%{box-shadow:0 0 0 0 rgba(254,202,87,.0)} }

.payouts{ margin-top:16px; color:#c8d1dc; font-size:14px }
.payouts table{ width:100%; border-collapse:collapse; border:1px solid #223045; border-radius:12px; overflow:hidden }
.payouts th, .payouts td{ padding:8px 10px; border-bottom:1px solid #1b2637; text-align:left }
.payouts tr:nth-child(odd){ background:#0c131c }

  </style>
</head>
<body>
  <div class="app">
    <h1>Einarmiger Bandit – 5 Walzen</h1>
    <div class="sub">Symbole: Kirsche (KIR), Zitrone (ZIT), Hufeisen (HUF), Kleeblatt (KLEE), 7 (SIEBEN). Eine Gewinnlinie (Mitte).</div><div class="machine" id="machine">
  <div class="status">
    <div class="left">
      <div class="chip"><strong id="credits">1000</strong><span>Credits</span></div>
      <div class="chip"><strong id="lastWin">0</strong><span>Letzter Gewinn</span></div>
      <div class="chip"><strong id="rtp">–</strong><span>RTP (Session)</span></div>
    </div>
    <div class="chip" title="Seed für reproduzierbare Tests"><strong id="seed">–</strong><span>RNG Seed</span></div>
  </div>

  <div class="reels" id="reels"></div>
  <div class="payline"></div>

  <div class="controls">
    <div class="left-ctrl">
      <button class="btn" id="btnSeed">Seed neu</button>
      <div class="bet">
        <label for="bet">Einsatz</label>
        <input id="bet" type="number" min="1" step="1" value="10" />
      </div>
    </div>
    <div>
      <button class="btn" id="btnAuto">Auto: Aus</button>
      <button class="btn primary" id="btnSpin">Drehen</button>
    </div>
  </div>

  <div class="log" id="log"></div>

  <div class="payouts">
    <table>
      <thead><tr><th>Kombination (Mittelreihe)</th><th>Auszahlung × Einsatz</th></tr></thead>
      <tbody>
        <tr><td>5× SIEBEN</td><td>100×</td></tr>
        <tr><td>5× KLEE</td><td>50×</td></tr>
        <tr><td>5× HUF</td><td>25×</td></tr>
        <tr><td>5× ZIT</td><td>10×</td></tr>
        <tr><td>5× KIR</td><td>5×</td></tr>
        <tr><td>Beliebige 3 gleiche</td><td>1×</td></tr>
      </tbody>
    </table>
  </div>
</div>

  </div><script>
/**
 * Einarmiger Bandit – Vanilla JS, eine Datei, GitHub Pages-fähig.
 * – 5 Walzen, je 3 sichtbare Symbole; eine Gewinnlinie (Mitte)
 * – Reproduzierbares RNG über Seeded PRNG
 * – Lokaler Speicher für Credits & Seed
 */

const SYMBOLS = [
  { id:'KIR', weight: 30 }, // Kirsche – häufig
  { id:'ZIT', weight: 24 }, // Zitrone
  { id:'HUF', weight: 16 }, // Hufeisen
  { id:'KLEE', weight: 10 }, // Kleeblatt
  { id:'SIEBEN', weight: 4 }, // 7 – selten
];

const PAYOUTS = {
  'SIEBEN': 100,
  'KLEE': 50,
  'HUF': 25,
  'ZIT': 10,
  'KIR': 5,
};

const STATE = {
  reels: 5,
  rows: 3,
  credits: Number(localStorage.getItem('slot_credits') ?? 1000),
  lastWin: 0,
  totalIn: 0,
  totalOut: 0,
  auto: false,
  spinning: false,
  seed: localStorage.getItem('slot_seed') || String(Math.floor(Math.random()*1e9)),
};

// Seeded PRNG (Mulberry32)
function makePRNG(seedStr){
  let h = 1779033703 ^ seedStr.length;
  for (let i=0;i<seedStr.length;i++){
    h = Math.imul(h ^ seedStr.charCodeAt(i), 3432918353);
    h = (h<<13) | (h>>>19);
  }
  return function(){
    h = Math.imul(h ^ (h>>>16), 2246822507);
    h = Math.imul(h ^ (h>>>13), 3266489909);
    h ^= h>>>16;
    // scale to [0,1)
    return (h>>>0) / 4294967296;
  }
}
let rnd = makePRNG(STATE.seed);

function weightedPick(){
  const total = SYMBOLS.reduce((a,s)=>a+s.weight,0);
  let r = rnd()*total;
  for(const s of SYMBOLS){
    if((r -= s.weight) <= 0) return s.id;
  }
  return SYMBOLS[SYMBOLS.length-1].id;
}

function symbolLabel(id){
  switch(id){
    case 'KIR': return 'KIR';
    case 'ZIT': return 'ZIT';
    case 'HUF': return 'HUF';
    case 'KLEE': return 'KLEE';
    case 'SIEBEN': return '7';
    default: return id;
  }
}

// Build DOM
const reelsEl = document.getElementById('reels');
const creditsEl = document.getElementById('credits');
const lastWinEl = document.getElementById('lastWin');
const rtpEl = document.getElementById('rtp');
const seedEl = document.getElementById('seed');
const logEl = document.getElementById('log');
const btnSpin = document.getElementById('btnSpin');
const btnAuto = document.getElementById('btnAuto');
const btnSeed = document.getElementById('btnSeed');
const betInput = document.getElementById('bet');
const machine = document.getElementById('machine');

seedEl.textContent = STATE.seed;

const reelNodes = [];
for(let r=0;r<STATE.reels;r++){
  const reel = document.createElement('div');
  reel.className = 'reel';
  const symbols = document.createElement('div');
  symbols.className = 'symbols';
  reel.appendChild(symbols);

  // Build a tall strip with many entries to fake spinning
  const STRIP_LEN = 40;
  for(let i=0;i<STRIP_LEN;i++){
    const id = weightedPick();
    const div = document.createElement('div');
    div.className='symbol';
    div.textContent = symbolLabel(id);
    div.dataset.id = id;
    symbols.appendChild(div);
  }
  reelsEl.appendChild(reel);
  reelNodes.push({reel, symbols, offset:0});
}

function setCredits(v){ STATE.credits = v; localStorage.setItem('slot_credits', String(v)); creditsEl.textContent = v; }
function setLastWin(v){ STATE.lastWin = v; lastWinEl.textContent = v; }
function setSeed(newSeed){ STATE.seed = newSeed; localStorage.setItem('slot_seed', String(newSeed)); seedEl.textContent = newSeed; rnd = makePRNG(newSeed); }

function log(msg){
  const time = new Date().toLocaleTimeString();
  logEl.innerHTML = `<div><b>${time}</b> – ${msg}</div>` + logEl.innerHTML;
}

function centerRowIDs(){
  // Read visible 3 rows per reel; pick middle symbol by measuring offset
  const results = [];
  for(const rn of reelNodes){
    const rect = rn.reel.getBoundingClientRect();
    const midY = rect.top + rect.height/2;
    const symbols = [...rn.symbols.children];
    let closest = null; let dmin = 1e9;
    for(const s of symbols){
      const r = s.getBoundingClientRect();
      const d = Math.abs((r.top + r.height/2) - midY);
      if(d < dmin){ dmin = d; closest = s; }
    }
    results.push(closest?.dataset.id || 'KIR');
  }
  return results;
}

function evaluate(ids, bet){
  // Simple: Gewinn nur bei gleichen Symbolen ab 3; 5-gleiche nutzen PAYOUTS
  const mid = ids;
  const counts = {};
  for(const id of mid){ counts[id] = (counts[id]||0)+1; }
  let bestId = null, bestCount = 0;
  for(const [id,c] of Object.entries(counts)){
    if(c>bestCount){ bestCount = c; bestId = id; }
  }
  let mult = 0;
  if(bestCount >= 5){ mult = PAYOUTS[bestId] ?? 0; }
  else if(bestCount === 4){ mult = Math.floor((PAYOUTS[bestId] ?? 0) * 0.3); }
  else if(bestCount === 3){ mult = 1; }
  const win = mult * bet;
  return {win, mult, bestId, bestCount};
}

async function spin(){
  if(STATE.spinning) return; // guard
  const bet = Math.max(1, Math.floor(Number(betInput.value)||1));
  if(STATE.credits < bet){ log('Zu wenig Credits.'); return; }
  STATE.spinning = true; btnSpin.disabled = true; btnAuto.disabled = true; btnSeed.disabled = true; betInput.disabled = true;

  setCredits(STATE.credits - bet); STATE.totalIn += bet;

  const DURATION_BASE = 1300; // ms
  const STAGGER = 220; // ms zwischen Walzen

  // Prepare animation state per reel
  const anim = reelNodes.map((rn,i)=>({
    start: performance.now() + i*STAGGER,
    duration: DURATION_BASE + i*180 + (rnd()*250)|0,
    speed: 0,
    last: 0,
    height: 60,
    stripLen: rn.symbols.children.length,
  }));

  return new Promise(resolve=>{
    function frame(t){
      let allDone = true;
      for(let i=0;i<reelNodes.length;i++){
        const rn = reelNodes[i];
        const a = anim[i];
        const elapsed = t - a.start;
        if(elapsed < 0){ allDone = false; continue; }
        if(elapsed < a.duration){
          allDone = false;
          // ease out speed
          const p = Math.min(1, elapsed / a.duration);
          const ease = 1 - Math.pow(1-p, 3);
          const base = 12; // px per frame max
          const spd = base * (1 - ease) + 1.5; // decelerate
          a.speed = spd;
          a.last = (a.last + spd) % (a.height * a.stripLen);
          rn.symbols.style.transform = `translateY(${-a.last}px)`;
        } else {
          // snap to nearest symbol center
          const mod = a.last % a.height;
          const snap = a.last - mod + (mod > a.height/2 ? a.height : 0);
          rn.symbols.style.transform = `translateY(${-snap}px)`;
        }
      }
      if(!allDone){ requestAnimationFrame(frame); }
      else {
        const ids = centerRowIDs();
        const {win, mult, bestId, bestCount} = evaluate(ids, bet);
        setLastWin(win); STATE.totalOut += win; setCredits(STATE.credits + win);
        const rtp = STATE.totalIn ? (STATE.totalOut/STATE.totalIn*100).toFixed(1)+'%' : '–';
        rtpEl.textContent = rtp;
        const combo = ids.join(' | ');
        if(win>0){
          machine.classList.remove('flash-win'); void machine.offsetWidth; machine.classList.add('flash-win');
          log(`Treffer: <b>${bestCount}× ${bestId}</b> (x${mult}). Linie: ${combo}. Gewinn: <b>${win}</b>.`);
        } else {
          log(`Niete. Linie: ${combo}.`);
        }
        STATE.spinning = false; btnSpin.disabled = false; btnAuto.disabled = false; btnSeed.disabled = false; betInput.disabled = false;
        resolve();
      }
    }
    requestAnimationFrame(frame);
  });
}

btnSpin.addEventListener('click', async()=>{
  await spin();
  if(STATE.auto){ setTimeout(()=>btnSpin.click(), 300); }
});

btnAuto.addEventListener('click', ()=>{
  STATE.auto = !STATE.auto; btnAuto.textContent = `Auto: ${STATE.auto?'An':'Aus'}`;
  if(STATE.auto && !STATE.spinning){ btnSpin.click(); }
});

btnSeed.addEventListener('click', ()=>{
  setSeed(String(Math.floor(Math.random()*1e9))); log('Neuer Seed gesetzt.');
});

// Init UI
setCredits(STATE.credits); setLastWin(STATE.lastWin);
log('Bereit. Drücke „Drehen“.');
</script></body>
</html>
